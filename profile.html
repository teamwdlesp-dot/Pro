<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELITE PRO | PROFILE</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --metal-bg: #e0e0e0;
            --metal-shadow: #bebebe;
            --metal-light: #ffffff;
            --text-color: #444;
            --accent: #2ecc71;
            --danger: #e74c3c;
            --premium: #f1c40f;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }

        body { 
            background-color: var(--metal-bg);
            color: var(--text-color);
            min-height: 100vh;
            padding-bottom: 110px;
            overflow-x: hidden;
        }

        /* GREETING ANIMATION LOOP */
        @keyframes greetingLoop {
            0% { transform: translateY(0px); opacity: 0.7; text-shadow: none; }
            50% { transform: translateY(-3px); opacity: 1; text-shadow: 0 0 10px rgba(46, 204, 113, 0.4); color: var(--accent); }
            100% { transform: translateY(0px); opacity: 0.7; text-shadow: none; }
        }
        .animate-greeting {
            display: inline-block;
            animation: greetingLoop 3s ease-in-out infinite;
        }

        /* RAIN ANIMATION */
        #rain-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .dot { position: absolute; background-color: #000; border-radius: 50%; opacity: 0.15; animation: fall linear infinite; }
        @keyframes fall { from { transform: translateY(-20px); } to { transform: translateY(110vh); } }

        /* PAGE HANDLING */
        .page { position: relative; z-index: 1; display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        header { padding: 30px 20px; text-align: center; position: relative; }
        .back-btn { position: absolute; left: 20px; top: 35px; width: 40px; height: 40px; border-radius: 50%; background: var(--metal-bg); display: flex; align-items: center; justify-content: center; box-shadow: 5px 5px 10px var(--metal-shadow), -5px -5px 10px var(--metal-light); border: none; color: var(--text-color); cursor: pointer; }

        /* PROFILE SECTION */
        .profile-hero { text-align: center; margin-bottom: 20px; }
        .avatar-container {
            width: 100px; height: 100px; border-radius: 50%; background: var(--metal-bg);
            margin: 0 auto 15px; display: flex; align-items: center; justify-content: center;
            box-shadow: 10px 10px 20px var(--metal-shadow), -10px -10px 20px var(--metal-light);
            position: relative; overflow: hidden;
        }
        .avatar-container img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .avatar-container i { font-size: 40px; color: #888; }
        .level-badge { position: absolute; bottom: 0; right: 0; background: var(--accent); color: white; font-size: 10px; font-weight: 700; padding: 4px 8px; border-radius: 10px; box-shadow: 0 4px 10px rgba(46,204,113,0.3); }

        .user-name { font-size: 20px; font-weight: 700; color: #444; margin-bottom: 5px; }
        .user-id { font-size: 11px; color: #999; font-weight: 700; letter-spacing: 1px; }

        /* ACHIEVEMENTS */
        .achievements-row { display: flex; overflow-x: auto; gap: 15px; padding: 10px 20px 25px; scrollbar-width: none; }
        .achievements-row::-webkit-scrollbar { display: none; }
        .badge-item { min-width: 65px; height: 65px; border-radius: 18px; background: var(--metal-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light); }
        .badge-item i { font-size: 20px; margin-bottom: 4px; color: var(--premium); }
        .badge-item span { font-size: 7px; font-weight: 700; text-transform: uppercase; color: #888; }

        .stats-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 0 20px; margin-bottom: 30px; }
        .stat-card { background: var(--metal-bg); padding: 15px 5px; border-radius: 20px; text-align: center; box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light); }
        .stat-card b { display: block; font-size: 16px; color: #444; }
        .stat-card span { font-size: 9px; color: #999; font-weight: 700; text-transform: uppercase; }

        .vip-card { margin: 0 20px 30px; padding: 20px; border-radius: 25px; background: var(--metal-bg); box-shadow: inset 6px 6px 12px var(--metal-shadow), inset -6px -6px 12px var(--metal-light); }
        .vip-header { display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; margin-bottom: 10px; }
        .progress-bar { height: 8px; background: #ccc; border-radius: 10px; overflow: hidden; }
        .progress-fill { width: 70%; height: 100%; background: var(--accent); border-radius: 10px; }

        /* SOCIAL BOX */
        .social-box { margin: 0 20px 25px; display: flex; justify-content: space-between; gap: 15px; }
        .social-btn { flex: 1; padding: 12px; border-radius: 15px; background: var(--metal-bg); text-align: center; box-shadow: 5px 5px 10px var(--metal-shadow), -5px -5px 10px var(--metal-light); color: #666; font-size: 18px; cursor: pointer; }

        .action-list { padding: 0 20px; }
        .action-item { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px; border-radius: 20px; background: var(--metal-bg); box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light); margin-bottom: 15px; text-decoration: none; color: #555; transition: 0.2s; cursor: pointer; }
        .action-item:active { transform: scale(0.98); box-shadow: inset 4px 4px 8px var(--metal-shadow); }
        .action-info { display: flex; align-items: center; gap: 15px; font-size: 13px; font-weight: 700; }
        .action-info i { width: 20px; color: #888; }

        .logout-btn { color: var(--danger); }
        .edit-input { width: 100%; padding: 15px; border-radius: 15px; border: none; outline: none; background: var(--metal-bg); box-shadow: inset 5px 5px 10px var(--metal-shadow), inset -5px -5px 10px var(--metal-light); margin-top: 8px; font-weight: 700; color: #444; }
        .save-btn { width: 100%; padding: 18px; border-radius: 20px; border: none; background: #444; color: white; font-weight: 700; text-transform: uppercase; cursor: pointer; margin-top: 20px; }
        
        #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 12px 25px; border-radius: 50px; font-size: 12px; font-weight: 700; z-index: 10000; display: none; }

        /* INVITE PAGE (ORIGINAL) */
        .invite-card-main { background: var(--metal-bg); border-radius: 40px; padding: 30px 20px; margin: 20px; box-shadow: 15px 15px 30px var(--metal-shadow), -15px -15px 30px var(--metal-light); text-align: center; }
        .invite-label { font-size: 10px; font-weight: 700; color: #888; letter-spacing: 1px; margin-bottom: 20px; text-transform: uppercase; }
        .sunken-code-box { background: var(--metal-bg); padding: 20px; border-radius: 25px; box-shadow: inset 6px 6px 12px var(--metal-shadow), inset -6px -6px 12px var(--metal-light); display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px; }
        .sunken-code-box b { font-size: 24px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; }
        .sunken-code-box i { font-size: 22px; color: #aaa; cursor: pointer; }
        .share-row { display: flex; justify-content: space-around; padding: 0 10px; margin-top: 30px; margin-bottom: 25px; }
        .share-method { text-align: center; cursor: pointer; }
        .share-circle { width: 55px; height: 55px; border-radius: 18px; background: var(--metal-bg); display: flex; align-items: center; justify-content: center; box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light); font-size: 22px; margin-bottom: 8px; }
        .share-method span { font-size: 9px; font-weight: 700; color: #888; }
        .rewards-section { padding: 0 25px; margin-bottom: 25px; }
        .reward-point { display: flex; align-items: center; gap: 10px; font-size: 12px; font-weight: 700; color: #666; margin-bottom: 10px; }
        .reward-point i { color: #f1c40f; font-size: 14px; }
        .invited-list-sunken { background: var(--metal-bg); border-radius: 30px; padding: 20px; margin: 0 20px 30px; box-shadow: inset 8px 8px 16px var(--metal-shadow), inset -8px -8px 16px var(--metal-light); min-height: 120px; text-align: center; }
        .list-title { font-size: 9px; font-weight: 700; color: #aaa; text-align: left; margin-bottom: 15px; letter-spacing: 1px; }
        .balance-card-raised { background: var(--metal-bg); border-radius: 35px; padding: 25px; margin: 0 20px; box-shadow: 10px 10px 20px var(--metal-shadow), -10px -10px 20px var(--metal-light); text-align: center; }
        .balance-card-raised span { font-size: 10px; font-weight: 700; color: #999; letter-spacing: 1px; }
        .balance-card-raised h1 { font-size: 36px; color: var(--accent); margin: 5px 0; }

        .history-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--metal-bg); border-radius: 15px; margin-bottom: 10px; box-shadow: 4px 4px 8px var(--metal-shadow), -4px -4px 8px var(--metal-light); }

        .floating { animation: floatLoop 3s infinite ease-in-out; }
        @keyframes floatLoop { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        nav { position: fixed; bottom: 20px; left: 20px; right: 20px; height: 75px; background: var(--metal-bg); border-radius: 25px; box-shadow: 10px 10px 30px var(--metal-shadow), -10px -10px 30px var(--metal-light); display: flex; justify-content: space-around; align-items: center; z-index: 100; }
        .nav-item { color: #999; text-decoration: none; display: flex; flex-direction: column; align-items: center; gap: 4px;}
        .nav-item i { font-size: 20px; }
        .nav-item span { font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .nav-item.active { color: #444; }
    </style>
</head>
<body>

    <div id="rain-container"></div>
    <div id="toast">Message</div>

    <!-- MAIN PROFILE PAGE -->
    <div id="profile-page" class="page active">
        <header>
            <span id="greeting" class="animate-greeting" style="font-weight: 700; font-size: 14px; letter-spacing: 2px;">USER PROFILE</span>
        </header>

        <div class="profile-hero">
            <div class="avatar-container">
                <img src="" id="display-logo">
                <i class="fas fa-user-shield" id="display-placeholder"></i>
                <div class="level-badge">LVL 04</div>
            </div>
            <h2 class="user-name" id="profile-name">Loading...</h2>
            <p class="user-id">PRO ID: #<span id="profile-id">88291</span></p>
        </div>

        <div class="achievements-row">
            <div class="badge-item"><i class="fas fa-crown"></i><span>Elite</span></div>
            <div class="badge-item"><i class="fas fa-fire"></i><span>Streak</span></div>
            <div class="badge-item"><i class="fas fa-shield-halved"></i><span>Pro</span></div>
            <div class="badge-item"><i class="fas fa-gem"></i><span>VIP</span></div>
            <div class="badge-item" style="opacity: 0.5;"><i class="fas fa-lock"></i><span>Master</span></div>
        </div>

        <div class="stats-container">
            <div class="stat-card"><b id="matches-played">0</b><span>Matches</span></div>
            <div class="stat-card"><b id="total-win">0</b><span>Wins</span></div>
            <div class="stat-card"><b id="total-win-amt">₹0</b><span>Winning</span></div>
        </div>

        <div class="vip-card">
            <div class="vip-header"><span>VIP ELITE CLUB</span><span style="color: var(--accent);">XP: 70%</span></div>
            <div class="progress-bar"><div class="progress-fill"></div></div>
            <p style="font-size: 9px; color: #888; margin-top: 8px; text-align: center;">EARN ₹300 MORE TO UNLOCK LVL 5</p>
        </div>

        <div class="social-box">
            <div class="social-btn" onclick="window.open('https://discord.com')"><i class="fab fa-discord" style="color:#5865F2"></i></div>
            <div class="social-btn" onclick="window.open('https://youtube.com')"><i class="fab fa-youtube" style="color:#FF0000"></i></div>
            <div class="social-btn" onclick="toast('Support Online')"><i class="fas fa-headset"></i></div>
        </div>

        <div class="action-list">
            <div class="action-item" onclick="showPage('edit-page')">
                <div class="action-info"><i class="fas fa-user-edit"></i> Edit Profile</div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="action-item" onclick="showPage('invite-page')">
                <div class="action-info"><i class="fas fa-share-nodes"></i> Invite & Share App</div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="action-item" onclick="showPage('history-page')">
                <div class="action-info"><i class="fas fa-history"></i> My History</div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <a href="wallet.html" class="action-item">
                <div class="action-info"><i class="fas fa-wallet"></i> My Wallet (₹<span id="wallet-bal">0</span>)</div>
                <i class="fas fa-chevron-right"></i>
            </a>
            <div class="action-item logout-btn" onclick="logout()">
                <div class="action-info"><i class="fas fa-sign-out-alt"></i> Sign Out</div>
            </div>
        </div>
    </div>

    <!-- INVITE & EARN PAGE -->
    <div id="invite-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('profile-page')"><i class="fas fa-arrow-left"></i></button>
            <span style="font-weight: 700; font-size: 14px; color: #888; letter-spacing: 2px;">INVITE & EARN</span>
        </header>

        <div class="invite-card-main floating">
            <p class="invite-label">Refer your friends & earn cash</p>
            <div class="sunken-code-box">
                <b id="invite-code-text">LOADING...</b>
                <i class="fas fa-copy" onclick="copyInvite()"></i>
            </div>
            <p style="font-size: 9px; color: #aaa;">Your friends get ₹<span id="refer-bonus-ui">0</span> bonus on signup!</p>
        </div>

        <div class="share-row">
            <div class="share-method" onclick="share('whatsapp')"><div class="share-circle" style="color:#25D366"><i class="fab fa-whatsapp"></i></div><span>WhatsApp</span></div>
            <div class="share-method" onclick="share('instagram')"><div class="share-circle" style="color:#E1306C"><i class="fab fa-instagram"></i></div><span>Instagram</span></div>
            <div class="share-method" onclick="share('telegram')"><div class="share-circle" style="color:#0088cc"><i class="fab fa-telegram"></i></div><span>Telegram</span></div>
            <div class="share-method" onclick="share('msg')"><div class="share-circle" style="color:#3498db"><i class="fas fa-comment-dots"></i></div><span>Messages</span></div>
        </div>

        <div class="rewards-section">
            <div class="reward-point"><i class="fas fa-circle-check"></i> Friend Joins: ₹<span id="referrer-bonus-ui">0.00</span></div>
            <div class="reward-point"><i class="fas fa-circle-check"></i> Friend First Match: ₹10.00</div>
        </div>

        <div class="invited-list-sunken">
            <p class="list-title">TOTAL INVITED USERS</p>
            <div id="invited-users-container">
                <p style="color: #bbb; font-size: 11px; margin-top: 20px;">No users invited yet.</p>
            </div>
        </div>

        <div class="balance-card-raised">
            <span>INVITE BALANCE</span>
            <h1 id="invite-bal-display">₹0.00</h1>
            <button class="save-btn" id="transfer-btn" style="margin-top: 10px; padding: 12px; font-size: 11px;" onclick="transferInviteBal()">Transfer to Wallet</button>
        </div>
    </div>

    <!-- HISTORY PAGE -->
    <div id="history-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('profile-page')"><i class="fas fa-arrow-left"></i></button>
            <span style="font-weight: 700; font-size: 14px; color: #888;">HISTORY</span>
        </header>
        <div style="padding: 20px;" id="history-container">
            <p style="text-align: center; color: #999;">Loading history...</p>
        </div>
    </div>

    <!-- EDIT PROFILE PAGE -->
    <div id="edit-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('profile-page')"><i class="fas fa-arrow-left"></i></button>
            <span style="font-weight: 700; font-size: 14px; color: #888;">EDIT PROFILE</span>
        </header>

        <div style="padding: 20px; text-align: center;">
            <div class="avatar-container" style="width: 120px; height: 120px;">
                <img src="" id="edit-preview">
                <i class="fas fa-camera" id="edit-placeholder"></i>
            </div>
            <label for="logo-input" class="action-item" style="justify-content: center; width: 180px; margin: 0 auto 20px;">
                <i class="fas fa-image"></i> Change Logo
            </label>
            <input type="file" id="logo-input" accept="image/*" style="display: none;">

            <div style="text-align: left; margin-top: 20px;">
                <label style="font-size: 10px; font-weight: 700; color: #999; margin-left: 10px;">GAMER NAME</label>
                <input type="text" id="name-input" class="edit-input" placeholder="New name">
            </div>
            <button class="save-btn" id="save-btn">Save Identity</button>
        </div>
    </div>

    <nav>
        <a href="room.html" class="nav-item"><i class="fas fa-gamepad"></i><span>Room</span></a>
        <a href="scrims.html" class="nav-item"><i class="fas fa-trophy"></i><span>Scrims</span></a>
        <a href="wallet.html" class="nav-item"><i class="fas fa-wallet"></i><span>Wallet</span></a>
        <a href="profile.html" class="nav-item active"><i class="fas fa-user-circle"></i><span>Profile</span></a>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, get, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCUv-QHXMF1vfI7faSTOcQ6WdtZgXjkdGM",
            authDomain: "elite-pro-de7e8.firebaseapp.com",
            databaseURL: "https://elite-pro-de7e8-default-rtdb.firebaseio.com",
            projectId: "elite-pro-de7e8",
            storageBucket: "elite-pro-de7e8.firebasestorage.app",
            messagingSenderId: "651793396398",
            appId: "1:651793396398:web:0148327f711c3062a7733f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- SESSION FIX: Get User Phone ---
        const userPhone = localStorage.getItem('userPhone');
        if(!userPhone) { window.location.href = "login.html"; }

        const imgbbKey = "4f3c7d9cb0f09a1a7734b385b154d57e";
        let currentLogo = "", inviteCode = "";

        // GREETING LOGIC
        function setGreeting() {
            const hour = new Date().getHours();
            let msg = "GOOD NIGHT";
            if(hour < 12) msg = "GOOD MORNING";
            else if(hour < 17) msg = "GOOD AFTERNOON";
            else msg = "GOOD EVENING";
            document.getElementById('greeting').innerText = msg;
        }
        setGreeting();

        function createRain() {
            const container = document.getElementById('rain-container');
            for (let i = 0; i < 50; i++) {
                const dot = document.createElement('div');
                dot.classList.add('dot');
                const size = Math.random() * 3 + 2 + 'px';
                dot.style.width = size; dot.style.height = size;
                dot.style.left = Math.random() * 100 + 'vw';
                dot.style.animationDuration = Math.random() * 3 + 2 + 's';
                dot.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(dot);
            }
        }
        createRain();

        window.showPage = (id) => { 
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active'); 
            window.scrollTo(0,0);
        };
        window.toast = (msg) => { 
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2500); 
        };

        // --- 1. FETCH ADMIN INVITE CONFIG ---
        onValue(ref(db, 'admin_settings/invite_config'), (snapshot) => {
            if(snapshot.exists()){
                const config = snapshot.val();
                document.getElementById('refer-bonus-ui').innerText = config.refer_bonus || 0;
                document.getElementById('referrer-bonus-ui').innerText = (config.referrer_bonus || 0).toFixed(2);
            }
        });

        // --- DATA SCOPED TO USER PHONE ---
        onValue(ref(db, `users/${userPhone}`), (snapshot) => {
            const data = snapshot.val();
            if(!data) return;
            
            // Profile Data
            const profile = data.profile;
            document.getElementById('profile-name').innerText = profile.name || "User";
            document.getElementById('name-input').value = profile.name || "";
            document.getElementById('profile-id').innerText = profile.proID || "88291";
            document.getElementById('total-win').innerText = profile.wins || "0";
            
            inviteCode = (profile.proID || "ELITE").toString();
            document.getElementById('invite-code-text').innerText = inviteCode;
            
            if(profile.logo) {
                currentLogo = profile.logo;
                document.getElementById('display-logo').src = profile.logo;
                document.getElementById('display-logo').style.display = "block";
                document.getElementById('display-placeholder').style.display = "none";
                document.getElementById('edit-preview').src = profile.logo;
                document.getElementById('edit-preview').style.display = "block";
                document.getElementById('edit-placeholder').style.display = "none";
            }

            // Wallet Data
            const wallet = data.wallet || {};
            document.getElementById('wallet-bal').innerText = (wallet.total_bal || 0).toLocaleString();
            document.getElementById('total-win-amt').innerText = "₹" + (wallet.win_bal || 0).toLocaleString();
            document.getElementById('invite-bal-display').innerText = "₹" + (wallet.invite_bal || 0).toFixed(2);

            // Matches
            const matchesCount = data.joined_matches ? Object.keys(data.joined_matches).length : 0;
            document.getElementById('matches-played').innerText = matchesCount;
        });

        // --- 2. TRANSFER INVITE BALANCE TO WALLET ---
        window.transferInviteBal = async () => {
            const btn = document.getElementById('transfer-btn');
            const userRef = ref(db, `users/${userPhone}`);
            
            try {
                const snapshot = await get(userRef);
                const userData = snapshot.val();
                const invBal = userData.wallet.invite_bal || 0;
                
                if(invBal <= 0) return toast("Balance is zero!");
                
                btn.innerText = "Processing...";
                btn.disabled = true;

                // Update Wallet
                await update(ref(db, `users/${userPhone}/wallet`), {
                    total_bal: (userData.wallet.total_bal || 0) + invBal,
                    dep_bal: (userData.wallet.dep_bal || 0) + invBal,
                    invite_bal: 0
                });

                // Add History
                await push(ref(db, `users/${userPhone}/history`), {
                    type: "Invite Cashout",
                    amount: invBal,
                    date: new Date().toLocaleString()
                });

                toast("Transferred to Wallet!");
            } catch (e) {
                toast("Transfer failed!");
            } finally {
                btn.innerText = "Transfer to Wallet";
                btn.disabled = false;
            }
        };

        // History
        onValue(ref(db, `users/${userPhone}/history`), (snap) => {
            const container = document.getElementById('history-container');
            if(!snap.exists()) {
                container.innerHTML = `<p style="text-align: center; color: #999;">No history found.</p>`;
                return;
            }
            let html = "";
            Object.values(snap.val()).reverse().forEach(h => {
                html += `
                    <div class="history-item">
                        <div style="font-size: 12px; font-weight: 700;">${h.type} <br><small style="color:#999">${h.date}</small></div>
                        <div style="color:var(--accent); font-weight: 700;">₹${h.amount}</div>
                    </div>`;
            });
            container.innerHTML = html;
        });

        window.logout = () => {
            if(confirm("Sign out from Elite Pro?")){
                localStorage.removeItem('userPhone');
                window.location.href = "login.html";
            }
        };

        window.copyInvite = () => { navigator.clipboard.writeText(inviteCode).then(() => toast("Code Copied!")); };

        window.share = (platform) => {
            const msg = `Hey! Join ELITE PRO, use my code ${inviteCode} for ₹10 bonus!`;
            let url = "";
            if(platform === 'whatsapp') url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
            if(platform === 'telegram') url = `https://t.me/share/url?url=${window.location.origin}&text=${encodeURIComponent(msg)}`;
            if(platform === 'instagram') { navigator.clipboard.writeText(msg); return toast("Copied!"); }
            if(platform === 'msg') url = `sms:?body=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
        };

        document.getElementById('logo-input').onchange = async (e) => {
            const file = e.target.files[0];
            if(!file) return;
            const formData = new FormData();
            formData.append("image", file);
            toast("Uploading...");
            try {
                const res = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, { method: "POST", body: formData });
                const data = await res.json();
                if(data.success) {
                    currentLogo = data.data.url;
                    document.getElementById('edit-preview').src = currentLogo;
                    document.getElementById('edit-preview').style.display = "block";
                    document.getElementById('edit-placeholder').style.display = "none";
                    toast("Photo Updated!");
                }
            } catch (err) { toast("Failed!"); }
        };

        document.getElementById('save-btn').onclick = async () => {
            const name = document.getElementById('name-input').value;
            if(!name) return toast("Name is required!");
            await update(ref(db, `users/${userPhone}/profile`), { name: name, logo: currentLogo });
            toast("Profile Updated!");
            showPage('profile-page');
        };
    </script>
</body>
</html>