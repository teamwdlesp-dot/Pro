<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ELITE  | Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --metal-bg: #e0e0e0;
            --metal-shadow: #bebebe;
            --metal-light: #ffffff;
            --text-color: #444;
            --accent: #2ecc71;
            --pending: #f39c12; /* Color for Pending status */
            --dim-text: #888;
            --danger: #ff4757;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }

        body { 
            background-color: var(--metal-bg);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 1px, rgba(255,255,255,0.05) 1px, rgba(255,255,255,0.05) 2px);
            color: var(--text-color);
            min-height: 100vh;
        }

        /* --- PREMIUM MODAL STYLE --- */
        #custom-alert-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px;
        }
        .modal-box {
            background: var(--metal-bg); border-radius: 30px; padding: 30px; width: 100%; max-width: 320px;
            box-shadow: 20px 20px 40px var(--metal-shadow), -20px -20px 40px var(--metal-light);
            text-align: center; transform: scale(0.7); opacity: 0; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-box.active { transform: scale(1); opacity: 1; }
        .modal-icon { font-size: 40px; margin-bottom: 15px; color: var(--danger); }
        .modal-box h2 { font-size: 18px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .modal-box p { font-size: 12px; color: #777; margin-bottom: 20px; line-height: 1.5; }
        .shake { animation: shakeAnim 0.4s ease-in-out; }
        @keyframes shakeAnim {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        /* --- PAGE HANDLING --- */
        .page { display: none; padding: 20px; padding-bottom: 120px; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        
        /* NEW ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- SHARED COMPONENTS --- */
        header { padding: 20px 0; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--metal-bg); display: flex; align-items: center; justify-content: center; box-shadow: 5px 5px 10px var(--metal-shadow), -5px -5px 10px var(--metal-light); cursor: pointer; border: none; color: var(--text-color); }
        .header-title { font-weight: 300; font-size: 14px; letter-spacing: 5px; text-transform: uppercase; color: #888; }

        /* --- RNG BADGE STYLE --- */
        .rng-badge {
            display: inline-flex; align-items: center; gap: 6px; padding: 6px 15px;
            background: var(--metal-bg); border-radius: 50px; margin-bottom: 15px;
            box-shadow: inset 2px 2px 5px var(--metal-shadow), inset -2px -2px 5px var(--metal-light);
            font-size: 10px; font-weight: 700; color: var(--accent); letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* --- CARD STYLE --- */
        .vault-card {
            background: var(--metal-bg); border-radius: 40px; padding: 30px;
            box-shadow: 15px 15px 35px var(--metal-shadow), -15px -15px 35px var(--metal-light);
            text-align: center; margin-bottom: 30px;
            animation: slideUp 0.6s ease-out;
        }
        .balance-amount { font-size: 40px; font-weight: 700; color: #444; text-shadow: 1px 1px 1px var(--metal-light); }

        /* --- VIP LEVEL --- */
        .vip-container {
            background: var(--metal-bg); border-radius: 25px; padding: 20px;
            box-shadow: 10px 10px 20px var(--metal-shadow), -10px -10px 20px var(--metal-light);
            margin-bottom: 30px;
            animation: slideUp 0.8s ease-out;
        }
        .vip-info { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 10px; font-weight: 700; color: #777; letter-spacing: 1px; }
        .vip-progress-bg {
            height: 10px; background: var(--metal-bg); border-radius: 10px;
            box-shadow: inset 4px 4px 8px var(--metal-shadow), inset -4px -4px 8px var(--metal-light);
            overflow: hidden; padding: 2px;
        }
        .vip-progress-fill {
            height: 100%; width: 70%; background: linear-gradient(90deg, #444, #666);
            border-radius: 10px; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        /* --- SUPPORT SECTION STYLE --- */
        .support-container {
            background: var(--metal-bg); border-radius: 30px; padding: 20px;
            box-shadow: 10px 10px 20px var(--metal-shadow), -10px -10px 20px var(--metal-light);
            margin-bottom: 30px; animation: slideUp 1s ease-out;
        }
        .support-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .support-item {
            background: var(--metal-bg); padding: 12px 5px; border-radius: 15px; text-align: center;
            box-shadow: 4px 4px 8px var(--metal-shadow), -4px -4px 8px var(--metal-light);
            cursor: pointer; transition: 0.2s; border: none;
        }
        .support-item i { font-size: 18px; color: #555; display: block; margin-bottom: 5px; }
        .support-item span { font-size: 9px; font-weight: 700; color: #888; text-transform: uppercase; }

        /* --- BANNER SECTION STYLE --- */
        .banner-container { margin-bottom: 30px; animation: slideUp 1.2s ease-out; }
        .banner-card {
            background: linear-gradient(135deg, #444, #222);
            border-radius: 25px; padding: 20px; color: white;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 10px 10px 20px var(--metal-shadow);
            margin-bottom: 15px;
        }
        .banner-img-dynamic { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; }
        .banner-icon { font-size: 30px; color: #f1c40f; }
        .banner-text h3 { font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .banner-text p { font-size: 10px; opacity: 0.7; margin-top: 3px; }

        /* --- INSIGHTS GRID (NEW) --- */
        .insights-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; animation: slideUp 1.4s ease-out; }
        .insight-card {
            background: var(--metal-bg); padding: 15px; border-radius: 20px;
            box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light);
            text-align: left;
        }
        .insight-card i { font-size: 14px; color: var(--accent); margin-bottom: 8px; }
        .insight-card h4 { font-size: 10px; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        .insight-card p { font-size: 14px; font-weight: 700; color: #555; margin-top: 2px; }

        /* --- PARTNERS SECTION (NEW) --- */
        .partners-section { text-align: center; padding: 20px 0; opacity: 0.6; animation: slideUp 1.6s ease-out; }
        .partners-title { font-size: 9px; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; }
        .partners-icons { display: flex; justify-content: center; gap: 20px; font-size: 20px; color: #777; }

        /* --- INPUTS --- */
        .input-group { margin-bottom: 25px; }
        label { font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; margin-left: 10px; letter-spacing: 1px; }
        input {
            width: 100%; padding: 18px; border-radius: 20px; border: none; outline: none;
            background: var(--metal-bg); color: #444; font-size: 16px; font-weight: 700;
            box-shadow: inset 5px 5px 10px var(--metal-shadow), inset -5px -5px 10px var(--metal-light);
            margin-top: 8px;
        }

        /* --- PAYMENT METHODS --- */
        .methods-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .method-item {
            background: var(--metal-bg); padding: 15px; border-radius: 20px; text-align: center;
            box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light);
            cursor: pointer; border: 2px solid transparent; transition: 0.3s;
        }
        .method-item.selected { border-color: var(--accent); box-shadow: inset 4px 4px 8px var(--metal-shadow); }
        .method-item i { font-size: 20px; margin-bottom: 5px; display: block; }
        .method-item span { font-size: 11px; font-weight: 700; color: #666; }

        /* --- TERMS BOX --- */
        .terms-box {
            margin-top: 30px; padding: 20px; border-radius: 20px;
            background: var(--metal-bg);
            box-shadow: inset 4px 4px 8px var(--metal-shadow), inset -4px -4px 8px var(--metal-light);
        }
        .terms-title { font-size: 10px; font-weight: 700; color: #777; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .terms-list { list-style: none; }
        .terms-list li { font-size: 9.5px; color: #888; line-height: 1.6; margin-bottom: 8px; display: flex; gap: 10px; align-items: flex-start; }
        .terms-list li i { font-size: 8px; margin-top: 4px; color: #aaa; }

        /* --- BUTTONS --- */
        .btn {
            width: 100%; padding: 18px; border-radius: 20px; border: none;
            background: var(--metal-bg); font-weight: 700; color: #666;
            box-shadow: 8px 8px 16px var(--metal-shadow), -8px -8px 16px var(--metal-light);
            cursor: pointer; text-transform: uppercase; transition: 0.2s;
        }
        .btn-primary { background: #444; color: white; margin-top: 10px; }
        .btn:active { transform: scale(0.98); }

        /* --- NAV --- */
        nav {
            position: fixed; bottom: 20px; left: 20px; right: 20px; height: 75px;
            background: var(--metal-bg); border-radius: 25px;
            box-shadow: 10px 10px 30px var(--metal-shadow), -10px -10px 30px var(--metal-light);
            display: flex; justify-content: space-around; align-items: center; z-index: 100;
        }
        .nav-item { 
            color: #999; text-decoration: none; 
            display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .nav-item i { font-size: 20px; }
        .nav-item span { font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .nav-item.active { color: #444; }

        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 30px; border-radius: 50px; background: #333; color: #fff; font-size: 11px; font-weight: 700; z-index: 1000; display: none; text-align: center; }

        /* --- SUCCESS ANIMATION OVERLAY --- */
        #success-animation-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 224, 224, 0.9); backdrop-filter: blur(8px);
            z-index: 9999; display: none; align-items: center; justify-content: center;
            flex-direction: column; overflow: hidden;
        }
        .success-card {
            background: var(--metal-bg); padding: 40px; border-radius: 40px;
            box-shadow: 20px 20px 60px var(--metal-shadow), -20px -20px 60px var(--metal-light);
            text-align: center; position: relative; z-index: 2;
        }
        .checkmark-circle {
            width: 80px; height: 80px; border-radius: 50%; display: block; stroke-width: 2;
            stroke: var(--accent); stroke-miterlimit: 10; margin: 0 auto 20px;
            box-shadow: inset 0px 0px 0px var(--accent); animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }
        .checkmark-check { transform-origin: 50% 50%; stroke-dasharray: 48; stroke-dashoffset: 48; animation: stroke .3s cubic-bezier(0.650, 0.000, 0.450, 1.000) .8s forwards; }
        @keyframes stroke { 100% { stroke-dashoffset: 0; } }
        @keyframes scale { 0%, 100% { transform: none; } 50% { transform: scale3d(1.1, 1.1, 1); } }
        @keyframes fill { 100% { box-shadow: inset 0px 0px 0px 50px var(--metal-bg); } }
        
        .confetti { position: absolute; width: 8px; height: 8px; background: #fff; border-radius: 2px; animation: confetti-fall 2.5s ease-out forwards; z-index: 1; }
        @keyframes confetti-fall { 0% { transform: translateY(-50px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

        /* --- HISTORY LIST ITEM --- */
        .history-item {
            background: var(--metal-bg); padding: 20px; border-radius: 25px; margin-bottom: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 6px 6px 12px var(--metal-shadow), -6px -6px 12px var(--metal-light);
            animation: fadeIn 0.3s ease;
        }
        .h-info h4 { font-size: 13px; color: #555; text-transform: uppercase; letter-spacing: 1px; }
        .h-info p { font-size: 9px; color: #aaa; margin-top: 3px; }
        .h-amt { font-weight: 700; font-size: 14px; }
    </style>
</head>
<body>

    <!-- PREMIUM ALERT MODAL -->
    <div id="custom-alert-modal">
        <div class="modal-box">
            <div class="modal-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <h2 id="alert-title">Notice</h2>
            <p id="alert-msg">Message here.</p>
            <button class="btn btn-primary" onclick="closeAlert()">CONTINUE</button>
        </div>
    </div>

    <!-- SUCCESS ANIMATION HTML -->
    <div id="success-animation-overlay">
        <div class="success-card">
            <svg class="checkmark-circle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                <circle class="checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                <path class="checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
            </svg>
            <h2 style="font-size: 18px; text-transform: uppercase; letter-spacing: 2px;">Request Sent</h2>
            <p style="font-size: 11px; color: #888; margin-top: 10px;">Waiting for Admin Approval</p>
        </div>
    </div>

    <div id="toast">Message here</div>

    <!-- WALLET HOME PAGE -->
    <div id="wallet-page" class="page active">
        <header>
            <div class="header-title">ELITE WALLET</div>
            <i class="fas fa-fingerprint" style="color: #aaa; font-size: 22px;"></i>
        </header>

        <!-- RNG SATISFIED LABEL -->
        <div style="text-align: center;">
            <div class="rng-badge">
                <i class="fas fa-shield-check"></i> RNG SATISFIED
            </div>
        </div>

        <div class="vault-card">
            <p style="font-size: 10px; font-weight: 700; color: #999; margin-bottom: 10px; text-transform: uppercase;">Total Balance</p>
            <div class="balance-amount">₹<span id="total-bal">0.00</span></div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.05);">
                <div>
                    <p style="font-size: 9px; color: #999;">WINNINGS</p>
                    <b style="font-size: 16px;" id="win-bal">₹0.00</b>
                </div>
                <div>
                    <p style="font-size: 9px; color: #999;">UNPLAYED</p>
                    <b style="font-size: 16px;" id="dep-bal">₹0.00</b>
                </div>
            </div>

            <!-- BUTTONS INSIDE CARD -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px;">
                <button class="btn" onclick="showPage('deposit-page')" style="color: var(--accent);">Deposit</button>
                <button class="btn" onclick="showPage('withdraw-page')">Withdraw</button>
            </div>
        </div>

        <!-- VIP LEVEL SECTION -->
        <div class="vip-container">
            <div class="vip-info">
                <span><i class="fas fa-shield-alt"></i> VIP LEVEL 4</span>
                <span style="color: #999;">XP: 70%</span>
            </div>
            <div class="vip-progress-bg">
                <div class="vip-progress-fill"></div>
            </div>
            <p style="font-size: 8px; color: #aaa; margin-top: 10px; text-align: center; text-transform: uppercase; letter-spacing: 1px;">₹400 MORE UNTIL NEXT LEVEL</p>
        </div>

        <!-- SUPPORT SECTION (NOW DYNAMIC) -->
        <div class="support-container">
            <p style="font-size: 10px; font-weight: 700; color: #999; text-transform: uppercase; letter-spacing: 1px;">Support Center</p>
            <div class="support-grid">
                <div class="support-item" onclick="openSupport('live')">
                    <i class="fas fa-headset"></i>
                    <span>Live Chat</span>
                </div>
                <div class="support-item" onclick="openSupport('wa')">
                    <i class="fab fa-whatsapp"></i>
                    <span>WhatsApp</span>
                </div>
                <div class="support-item" onclick="openSupport('tg')">
                    <i class="fab fa-telegram-plane"></i>
                    <span>Telegram</span>
                </div>
            </div>
        </div>

        <!-- BANNER SECTION (NOW DYNAMIC) -->
        <div class="banner-container" id="dynamic-banners">
            <!-- Admin Banners will load here -->
            <div class="banner-card">
                <i class="fas fa-gift banner-icon"></i>
                <div class="banner-text">
                    <h3>Refer & Earn ₹100</h3>
                    <p>Invite friends and get instant cash in winnings.</p>
                </div>
            </div>
        </div>

        <!-- ACCOUNT INSIGHTS GRID (NOW DYNAMIC) -->
        <div class="insights-grid">
            <div class="insight-card">
                <i class="fas fa-chart-line"></i>
                <h4>Total Activity</h4>
                <p id="admin-activity">₹1,250.00</p>
            </div>
            <div class="insight-card">
                <i class="fas fa-shield-alt"></i>
                <h4>Security</h4>
                <p id="admin-security">Level 02</p>
            </div>
        </div>

        <!-- PARTNERS & FOOTER (NEW) -->
        <div class="partners-section">
            <p class="partners-title">Secure Payment Partners</p>
            <div class="partners-icons">
                <i class="fab fa-cc-visa"></i>
                <i class="fab fa-cc-mastercard"></i>
                <i class="fas fa-university"></i>
                <i class="fas fa-lock"></i>
            </div>
            <p style="font-size: 8px; color: #aaa; margin-top: 15px; letter-spacing: 1px;">© 2024 SILVER INDUSTRIAL VAULT PRO</p>
        </div>
    </div>

    <!-- DEPOSIT PAGE -->
    <div id="deposit-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('wallet-page')"><i class="fas fa-arrow-left"></i></button>
            <div class="header-title">Add Funds</div>
            <button class="back-btn" onclick="showPage('history-page')" style="box-shadow: 4px 4px 8px var(--metal-shadow), -4px -4px 8px var(--metal-light);"><i class="fas fa-history"></i></button>
        </header>

        <div class="input-group">
            <label>Amount (₹)</label>
            <input type="number" id="dep-input" placeholder="Min. ₹10">
        </div>

        <div class="methods-grid">
            <div class="method-item" onclick="selectMethod(this, 'PhonePe')"><i class="fab fa-amazon-pay" style="color:#5f259f"></i><span>PhonePe</span></div>
            <div class="method-item" onclick="selectMethod(this, 'Paytm')"><i class="fas fa-wallet" style="color:#00BAF2"></i><span>Paytm</span></div>
            <div class="method-item" onclick="selectMethod(this, 'GPay')"><i class="fab fa-google-pay" style="color:#4285F4"></i><span>GPay</span></div>
            <div class="method-item" onclick="selectMethod(this, 'FamPay')"><i class="fas fa-bolt" style="color:#000"></i><span>FamPay</span></div>
        </div>

        <button class="btn btn-primary" id="confirm-dep">DEPOSIT NOW</button>

        <div class="terms-box">
            <p class="terms-title"><i class="fas fa-shield-alt"></i> Deposit Policy</p>
            <ul class="terms-list" id="dep-terms-list">
                <li><i class="fas fa-circle"></i> Minimum deposit amount is ₹10.00.</li>
                <li><i class="fas fa-circle"></i> Deposits usually reflect after admin approval.</li>
                <li><i class="fas fa-circle"></i> Once added, funds cannot be refunded to bank.</li>
                <li><i class="fas fa-circle"></i> Status will be "Pending" until approved by admin.</li>
            </ul>
        </div>
    </div>

    <!-- WITHDRAW PAGE -->
    <div id="withdraw-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('wallet-page')"><i class="fas fa-arrow-left"></i></button>
            <div class="header-title">Withdrawal</div>
            <button class="back-btn" onclick="showPage('history-page')" style="box-shadow: 4px 4px 8px var(--metal-shadow), -4px -4px 8px var(--metal-light);"><i class="fas fa-history"></i></button>
        </header>

        <div class="vault-card" style="padding: 20px; border-radius: 20px; margin-bottom: 20px;">
            <p style="font-size: 9px; color: #999;">Withdrawable Winnings</p>
            <h2 style="color: var(--accent); margin-top: 5px;">₹<span id="withdrawable-bal">0.00</span></h2>
        </div>

        <div class="input-group">
            <label>Amount to Payout</label>
            <input type="number" id="wd-input" placeholder="Min. ₹100">
        </div>

        <div class="input-group">
            <label>Your UPI ID</label>
            <input type="text" id="upi-input" placeholder="username@upi">
        </div>

        <button class="btn btn-primary" id="confirm-wd">Submit Payout Request</button>

        <div class="terms-box">
            <p class="terms-title"><i class="fas fa-info-circle"></i> Withdrawal Rules</p>
            <ul class="terms-list" id="wd-terms-list">
                <li><i class="fas fa-circle"></i> Minimum withdrawal limit is ₹100.00.</li>
                <li><i class="fas fa-circle"></i> Only "Winning Balance" can be withdrawn.</li>
                <li><i class="fas fa-circle"></i> Double check UPI ID; incorrect ID transfers are not reversible.</li>
                <li><i class="fas fa-circle"></i> Processing time depends on admin verification.</li>
            </ul>
        </div>
    </div>

    <!-- HISTORY PAGE -->
    <div id="history-page" class="page">
        <header>
            <button class="back-btn" onclick="showPage('wallet-page')"><i class="fas fa-arrow-left"></i></button>
            <div class="header-title">History</div>
            <div style="width: 45px;"></div>
        </header>

        <div id="history-list-container">
            <div style="text-align: center; padding: 40px; color: #aaa;">
                <i class="fas fa-clipboard-list" style="font-size: 50px; margin-bottom: 20px;"></i>
                <p style="font-size: 12px; letter-spacing: 1px;">No transaction logs found.</p>
            </div>
        </div>
    </div>

    <!-- UPDATED NAVIGATION BAR -->
    <nav>
        <a href="room.html" class="nav-item">
            <i class="fas fa-gamepad"></i>
            <span>Room</span>
        </a>
        <a href="scrims.html" class="nav-item">
            <i class="fas fa-trophy"></i>
            <span>Scrims</span>
        </a>
        <a href="wallet.html" class="nav-item active">
            <i class="fas fa-wallet"></i>
            <span>Wallet</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user-circle"></i>
            <span>Profile</span>
        </a>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCUv-QHXMF1vfI7faSTOcQ6WdtZgXjkdGM",
          authDomain: "elite-pro-de7e8.firebaseapp.com",
          databaseURL: "https://elite-pro-de7e8-default-rtdb.firebaseio.com",
          projectId: "elite-pro-de7e8",
          storageBucket: "elite-pro-de7e8.firebasestorage.app",
          messagingSenderId: "651793396398",
          appId: "1:651793396398:web:0148327f711c3062a7733f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // --- SESSION FIX: Get User Phone ---
        const userPhone = localStorage.getItem('userPhone');
        if(!userPhone) { window.location.href = "login.html"; }

        let currentData = { total_bal: 0, win_bal: 0, dep_bal: 0 };
        let userName = "User";
        let liveLimits = { min_dep: 10, max_dep: 10000, min_wd: 100, max_wd: 5000 }; // Default
        window.selectedMethod = null;

        // --- PREMIUM ALERT LOGIC ---
        window.showAlert = (title, msg) => {
            const modal = document.getElementById('custom-alert-modal');
            const box = modal.querySelector('.modal-box');
            document.getElementById('alert-title').innerText = title;
            document.getElementById('alert-msg').innerText = msg;
            modal.style.display = 'flex';
            setTimeout(() => {
                box.classList.add('active');
                box.classList.add('shake');
            }, 50);
            setTimeout(() => box.classList.remove('shake'), 500);
        };

        window.closeAlert = () => {
            const modal = document.getElementById('custom-alert-modal');
            const box = modal.querySelector('.modal-box');
            box.classList.remove('active');
            setTimeout(() => modal.style.display = 'none', 300);
        };

        // Paths based on phone number for safety
        const walletRef = ref(db, `users/${userPhone}/wallet`);
        const historyRef = ref(db, `users/${userPhone}/history`);
        const profileRef = ref(db, `users/${userPhone}/profile`);

        // Admin paths include phone for identification
        const adminDepRef = ref(db, `admin/deposit_requests/${userPhone}`);
        const adminWdRef = ref(db, `admin/withdraw_requests/${userPhone}`);

        // --- FETCH ADMIN LIMITS ---
        onValue(ref(db, 'admin_settings/limits'), (snap) => {
            if(snap.exists()) {
                liveLimits = snap.val();
                // Update UI Placeholders
                document.getElementById('dep-input').placeholder = `Min ₹${liveLimits.min_dep} - Max ₹${liveLimits.max_dep}`;
                document.getElementById('wd-input').placeholder = `Min ₹${liveLimits.min_wd} - Max ₹${liveLimits.max_wd}`;
                
                // Update Terms
                document.getElementById('dep-terms-list').innerHTML = `
                    <li><i class="fas fa-circle"></i> Deposit Range: ₹${liveLimits.min_dep} - ₹${liveLimits.max_dep}</li>
                    <li><i class="fas fa-circle"></i> Deposits usually reflect after admin approval.</li>
                `;
                document.getElementById('wd-terms-list').innerHTML = `
                    <li><i class="fas fa-circle"></i> Withdrawal Range: ₹${liveLimits.min_wd} - ₹${liveLimits.max_wd}</li>
                    <li><i class="fas fa-circle"></i> Processing time depends on admin verification.</li>
                `;
            }
        });

        // --- FETCH USER DATA ---
        onValue(profileRef, (snap) => {
            if(snap.exists()) {
                userName = snap.val().name || "User";
            }
        });

        onValue(walletRef, (snapshot) => {
            const data = snapshot.val();
            if(data) {
                currentData = data;
                const total = data.total_bal ?? 0;
                const win = data.win_bal ?? 0;
                const dep = data.dep_bal ?? 0;

                document.getElementById('total-bal').innerText = total.toLocaleString('en-IN', {minimumFractionDigits: 2});
                document.getElementById('win-bal').innerText = "₹" + win;
                document.getElementById('dep-bal').innerText = "₹" + dep;
                document.getElementById('withdrawable-bal').innerText = win.toLocaleString('en-IN', {minimumFractionDigits: 2});
            }
        });

        // ==========================================
        // SYNC ADMIN SETTINGS (BANNER, CARD, SUPPORT)
        // ==========================================

        // 1. Sync Banner
        onValue(ref(db, 'admin_settings/banner'), (snap) => {
            if(snap.exists()){
                const data = snap.val();
                document.getElementById('dynamic-banners').innerHTML = `
                    <div class="banner-card">
                        <img src="${data.url}" class="banner-img-dynamic">
                        <div class="banner-text">
                            <h3>${data.title}</h3>
                            <p>Latest update from administration.</p>
                        </div>
                    </div>`;
            }
        });

        // 2. Sync Card Insights
        onValue(ref(db, 'admin_settings/insights'), (snap) => {
            if(snap.exists()){
                const data = snap.val();
                document.getElementById('admin-activity').innerText = data.activity;
                document.getElementById('admin-security').innerText = data.security;
            }
        });

        // 3. Sync Support Links
        let supportData = {};
        onValue(ref(db, 'admin_settings/support'), (snap) => {
            if(snap.exists()) supportData = snap.val();
        });

        window.openSupport = (type) => {
            if(!supportData.wa && !supportData.tg && !supportData.live) return toast("Connecting...");
            if(type === 'wa' && supportData.wa) window.location.href = `https://wa.me/${supportData.wa}`;
            else if(type === 'tg' && supportData.tg) window.location.href = supportData.tg;
            else if(type === 'live' && supportData.live) window.location.href = supportData.live;
            else toast("Not available");
        }

        // --- FETCH HISTORY ---
        onValue(historyRef, (snapshot) => {
            const container = document.getElementById('history-list-container');
            const data = snapshot.val();
            if(data) {
                container.innerHTML = "";
                const logs = Object.values(data).reverse();
                logs.forEach(log => {
                    const isCredit = (log.type === 'Deposit' || log.type === 'Deposit Request');
                    let color = isCredit ? '#2ecc71' : '#e74c3c';
                    
                    if(log.status === 'Pending') color = '#f39c12';
                    if(log.status === 'Rejected') color = '#e74c3c';

                    container.innerHTML += `
                        <div class="history-item">
                            <div class="h-info">
                                <h4>${log.type}</h4>
                                <p>${log.date} • <b>${log.status}</b></p>
                            </div>
                            <div class="h-amt" style="color: ${color}">
                                ${isCredit ? '+' : '-'} ₹${log.amount}
                            </div>
                        </div>
                    `;
                });
            }
        });

        // DEPOSIT REQUEST LOGIC
        document.getElementById('confirm-dep').onclick = async () => {
            const amt = parseFloat(document.getElementById('dep-input').value);
            
            // Limit Validation
            if(!amt || amt < liveLimits.min_dep) return showAlert("Limit Error", `Minimum deposit is ₹${liveLimits.min_dep}`);
            if(amt > liveLimits.max_dep) return showAlert("Limit Error", `Maximum deposit allowed is ₹${liveLimits.max_dep}`);
            if(!window.selectedMethod) return showAlert("Notice", "Select a Payment Method first");

            const date = new Date().toLocaleString('en-IN', { day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' });
            
            // Add to Personal History
            const newHistRef = push(historyRef);
            const historyKey = newHistRef.key;
            
            await set(newHistRef, {
                type: 'Deposit Request',
                amount: amt,
                date: date,
                status: 'Pending'
            });

            // Add to Admin Node
            const newReqRef = push(adminDepRef);
            await set(newReqRef, {
                amount: amt,
                method: window.selectedMethod,
                date: date,
                status: 'Pending',
                type: 'Deposit',
                historyKey: historyKey,
                userName: userName,
                phone: userPhone
            });

            triggerSuccessAnimation();
        };

        // WITHDRAW REQUEST LOGIC
        document.getElementById('confirm-wd').onclick = async () => {
            const amt = parseFloat(document.getElementById('wd-input').value);
            const upi = document.getElementById('upi-input').value;
            
            // Limit Validation
            if(!amt || amt < liveLimits.min_wd) return showAlert("Limit Error", `Minimum withdrawal is ₹${liveLimits.min_wd}`);
            if(amt > liveLimits.max_wd) return showAlert("Limit Error", `Maximum withdrawal allowed is ₹${liveLimits.max_wd}`);
            if(amt > currentData.win_bal) return showAlert("Balance Error", "Insufficient Winnings Balance");
            if(!upi.includes('@')) return showAlert("Format Error", "Enter a valid UPI ID");

            const date = new Date().toLocaleString('en-IN', { day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' });
            
            // Add to Personal History
            const newHistRef = push(historyRef);
            const historyKey = newHistRef.key;
            
            await set(newHistRef, {
                type: 'Withdraw Request',
                amount: amt,
                date: date,
                status: 'Pending'
            });

            // Add to Admin Node
            const newWdReqRef = push(adminWdRef);
            await set(newWdReqRef, {
                amount: amt,
                upi: upi,
                date: date,
                status: 'Pending',
                type: 'Withdraw',
                historyKey: historyKey,
                userName: userName,
                phone: userPhone
            });

            toast("Withdrawal request submitted for approval.");
            document.getElementById('wd-input').value = "";
            showPage('wallet-page');
        };

        function triggerSuccessAnimation() {
            const overlay = document.getElementById('success-animation-overlay');
            overlay.style.display = 'flex';
            for (let i = 0; i < 40; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = ['#fff', '#bdc3c7', '#2ecc71', '#e0e0e0'][Math.floor(Math.random() * 4)];
                confetti.style.animationDelay = Math.random() * 1.5 + 's';
                confetti.style.width = Math.random() * 8 + 4 + 'px';
                confetti.style.height = confetti.style.width;
                overlay.appendChild(confetti);
            }
            setTimeout(() => {
                overlay.style.display = 'none';
                overlay.querySelectorAll('.confetti').forEach(c => c.remove());
                document.getElementById('dep-input').value = "";
                showPage('wallet-page');
            }, 3000);
        }
    </script>

    <script>
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const page = document.getElementById(pageId);
            if(page) page.classList.add('active');
            window.scrollTo(0,0);
        }
        window.showPage = showPage;
        function selectMethod(el, m) {
            document.querySelectorAll('.method-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            window.selectedMethod = m;
        }
        window.selectMethod = selectMethod;
        function toast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 3000);
        }
    </script>
</body>
</html>